<div class="dashboard-container">
  <!-- Dashboard Content - Always Visible -->
  <div class="dashboard-content">
  
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="welcome-section">
        <h1 class="dashboard-title">Dashboard</h1>
        <p class="company-info">{{ getCurrentOrgName() }}</p>
        <span *ngIf="isUserSystemAdmin" class="admin-badge">System Admin</span>
      </div>
      
      <!-- Organization Switcher for Admins -->
      <div class="org-switcher-container" *ngIf="isUserSystemAdmin">
        <button (click)="toggleOrgSwitcher()" class="org-switcher-btn">
          <span class="switch-icon">üîÑ</span>
          Switch Organization
        </button>
        
        <!-- Dropdown for org selection -->
        <div class="org-dropdown" *ngIf="showOrgSwitcher">
          <div class="dropdown-header">
            <h4>Switch to Organization:</h4>
            <button (click)="toggleOrgSwitcher()" class="close-btn">√ó</button>
          </div>
          <div class="org-list">
            <div 
              *ngFor="let org of availableOrgs" 
              class="org-item"
              [class.selected]="selectedOrgForSwitch === org.org_short_name"
              (click)="selectedOrgForSwitch = org.org_short_name">
              <span class="org-name">{{ getOrgDisplayName(org) }}</span>
              <span class="org-type">{{ getOrgSubscriptionPlan(org) }}</span>
            </div>
          </div>
          <div class="dropdown-actions">
            <button 
              (click)="switchToOrganization()" 
              [disabled]="!selectedOrgForSwitch"
              class="switch-btn">
              Switch Now
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Action Section -->
  <div class="quick-actions">
    <button class="create-report-btn" (click)="createNewReport()">
      ‚ûï Create New Report
    </button>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <!-- Pending Reports Card -->
    <div class="stats-card pending-card" (click)="navigateToReports()">
      <div class="card-header">
        <div class="card-icon pending-icon">
          ‚è∞
        </div>
        <div class="card-title">Pending Reports</div>
      </div>
      <div class="card-content">
        <div class="card-number">
          <span *ngIf="!dataLoading; else loadingNumber">{{ stats.pending_reports }}</span>
          <ng-template #loadingNumber>
            <div class="number-skeleton"></div>
          </ng-template>
        </div>
        <div class="card-subtitle">
          {{ getCurrentOrgName() }}
        </div>
      </div>
      <div class="card-footer">
        <span class="view-all">View All ‚Üí</span>
      </div>
    </div>

    <!-- Created Reports Card -->
    <div class="stats-card created-card" (click)="navigateToReports()">
      <div class="card-header">
        <div class="card-icon created-icon">
          üìÑ
        </div>
        <div class="card-title">Created Reports</div>
      </div>
      <div class="card-content">
        <div class="card-number">
          <span *ngIf="!dataLoading; else loadingNumber">{{ stats.total_reports }}</span>
          <ng-template #loadingNumber>
            <div class="number-skeleton"></div>
          </ng-template>
        </div>
        <div class="card-subtitle">
          Organization Reports
        </div>
      </div>
      <div class="card-footer">
        <span class="view-all">View All ‚Üí</span>
      </div>
    </div>

    <!-- Banks Card -->
    <div class="stats-card banks-card" (click)="navigateToBanks()">
      <div class="card-header">
        <div class="card-icon banks-icon">
          üè¶
        </div>
        <div class="card-title">Banks</div>
      </div>
      <div class="card-content">
        <div class="card-number">
          <span *ngIf="!dataLoading; else loadingNumber">{{ banks.length }}</span>
          <ng-template #loadingNumber>
            <div class="number-skeleton"></div>
          </ng-template>
        </div>
        <div class="card-subtitle">
          Available Banks
        </div>
      </div>
      <div class="card-footer">
        <span class="view-all">View All ‚Üí</span>
      </div>
    </div>

    <!-- Templates Card -->
    <div class="stats-card templates-card" (click)="navigateToTemplates()">
      <div class="card-header">
        <div class="card-icon templates-icon">
          üìã
        </div>
        <div class="card-title">Templates</div>
      </div>
      <div class="card-content">
        <div class="card-number">
          <span *ngIf="!dataLoading; else loadingNumber">{{ stats.custom_templates }}</span>
          <ng-template #loadingNumber>
            <div class="number-skeleton"></div>
          </ng-template>
        </div>
        <div class="card-subtitle">
          Custom Templates
        </div>
      </div>
      <div class="card-footer">
        <span class="view-all">View All ‚Üí</span>
      </div>
    </div>

    <!-- Companies Card (Admin Only) -->
    <div class="stats-card companies-card" *ngIf="isSystemAdmin">
      <div class="card-header">
        <div class="card-icon companies-icon">
          üè¢
        </div>
        <div class="card-title">Users</div>
      </div>
      <div class="card-content">
        <div class="card-number">
          <span *ngIf="!dataLoading; else loadingNumber">{{ stats.total_users }}</span>
          <ng-template #loadingNumber>
            <div class="number-skeleton"></div>
          </ng-template>
        </div>
        <div class="card-subtitle">Active Users</div>
      </div>
      <div class="card-footer">
        <span class="view-all">Manage ‚Üí</span>
      </div>
    </div>
  </div>

  <!-- Recent Activity Section -->
  <div class="recent-activity">
    <div class="activity-header">
      <h2 class="activity-title">Recent Activity</h2>
      <p class="activity-subtitle">Latest report activities</p>
    </div>
    
    <!-- Loading State for Activities -->
    <div class="activity-loading" *ngIf="dataLoading">
      <div class="activity-skeleton" *ngFor="let item of [1,2,3,4,5]">
        <div class="skeleton-date"></div>
        <div class="skeleton-content">
          <div class="skeleton-line"></div>
          <div class="skeleton-user"></div>
        </div>
      </div>
    </div>
    
    <!-- Actual Activities -->
    <div class="activity-list" *ngIf="!dataLoading && recentActivities.length > 0">
      <div class="activity-item" *ngFor="let activity of recentActivities">
        <div class="activity-date">{{ formatDate(activity.timestamp) }}</div>
        <div class="activity-content">
          <div class="activity-type" [class]="activity.action">
            {{ getActivityDescription(activity) }}
          </div>
          <div class="activity-user">
            by {{ activity.user_email }}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Empty State -->
    <div class="empty-state" *ngIf="!dataLoading && recentActivities.length === 0">
      <p>No recent activities found</p>
    </div>
  </div>
  
  </div> <!-- End dashboard-content -->
</div>
