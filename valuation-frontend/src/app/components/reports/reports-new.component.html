<div class="reports-container">
  <!-- Header Section -->
  <div class="reports-header">
    <div class="header-content">
      <div class="header-title">
        <h1>ğŸ“Š Reports</h1>
        <p>Manage and view all organization reports</p>
      </div>
      
      <div class="header-actions">
        <button class="create-btn" (click)="createNewReport()">
          â• Create New Report
        </button>
        
        <button class="filter-btn" (click)="toggleFilters()" [class.active]="showFilters">
          ğŸ” Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section" *ngIf="showFilters">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Status</label>
        <select [(ngModel)]="filterStatus" (change)="applyFilters()">
          <option value="">All Statuses</option>
          <option value="draft">Draft</option>
          <option value="saved">Saved</option>
          <option value="submitted">Submitted</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Bank</label>
        <select [(ngModel)]="filterBank" (change)="applyFilters()">
          <option value="">All Banks</option>
          <option *ngFor="let bank of banks" [value]="bank.bankCode">
            {{ bank.bankName }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Property Type</label>
        <select [(ngModel)]="filterPropertyType" (change)="applyFilters()">
          <option value="">All Types</option>
          <option value="land-property">Land Property</option>
          <option value="residential">Residential</option>
          <option value="commercial">Commercial</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Created By</label>
        <input type="text" [(ngModel)]="filterCreatedBy" (keyup.enter)="applyFilters()" 
               placeholder="Email or name">
      </div>

      <div class="filter-group">
        <label>Reference</label>
        <input type="text" [(ngModel)]="filterReference" (keyup.enter)="applyFilters()" 
               placeholder="Report reference">
      </div>

      <div class="filter-group">
        <label>Applicant Name</label>
        <input type="text" [(ngModel)]="filterApplicantName" (keyup.enter)="applyFilters()" 
               placeholder="Applicant name">
      </div>

      <div class="filter-actions">
        <button class="clear-filters-btn" (click)="clearFilters()">
          ğŸ—‘ï¸ Clear All Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Tabs Section -->
  <div class="tabs-section">
    <div class="tabs">
      <button 
        class="tab-btn" 
        [class.active]="selectedTab === 'all'"
        (click)="selectTab('all')">
        All Reports ({{ totalReports }})
      </button>
      <button 
        class="tab-btn" 
        [class.active]="selectedTab === 'draft'"
        (click)="selectTab('draft')">
        Draft Reports
      </button>
      <button 
        class="tab-btn" 
        [class.active]="selectedTab === 'submitted'"
        (click)="selectTab('submitted')">
        Submitted Reports
      </button>
    </div>
  </div>

  <!-- Reports Table -->
  <div class="reports-content">
    <!-- Debug info -->

    
    <div class="loading-state" *ngIf="loading">
      <div class="loading-spinner"></div>
      <p>Loading reports...</p>
    </div>

    <div class="empty-state" *ngIf="!loading && reports.length === 0">
      <div class="empty-icon">ğŸ“„</div>
      <h3>No reports found</h3>
      <p>No reports match your current filters.</p>
      <button class="create-btn" (click)="createNewReport()">Create Your First Report</button>
    </div>

    <!-- Summary Info -->
    <div class="summary-info" style="background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px;">
      <strong>ï¿½ Reports Summary:</strong> 
      Showing {{ reports.length }} {{ selectedTab === 'all' ? 'total' : selectedTab }} reports
      <span *ngIf="allReports.length > 0"> ({{ allReports.length }} total loaded)</span>
    </div>

    <div class="reports-table" *ngIf="!loading && reports.length > 0">
      <div class="table-header">
        <div class="col-ref">Reference</div>
        <div class="col-applicant">Applicant Name</div>
        <div class="col-address">Address</div>
        <div class="col-bank">Bank</div>
        <div class="col-property-type">Property Type</div>
        <div class="col-status">Status</div>
        <div class="col-created-by">Created By</div>
        <div class="col-created">Created</div>
        <div class="col-updated">Updated</div>
        <div class="col-actions">Actions</div>
      </div>

      <div class="table-body">
        <div 
          class="table-row" 
          *ngFor="let report of reports" 
          (click)="viewReport(report)"
          [class]="'status-' + report.status">
          
          <div class="col-ref">
            <div class="ref-number">{{ report.reference_number || report.report_id }}</div>
          </div>
          
          <div class="col-applicant">
            <div class="applicant-name">{{ getApplicantName(report) }}</div>
          </div>
          
          <div class="col-address">
            <div class="address-text">{{ getPostalAddress(report) }}</div>
          </div>
          
          <div class="col-bank">
            <span class="bank-code">{{ report.bank_code }}</span>
          </div>
          
          <div class="col-property-type">
            <span class="property-type">{{ getPropertyTypeDisplayName(report) }}</span>
          </div>
          
          <div class="col-status">
            <span class="status-badge" [class]="getStatusClass(report.status)">
              {{ getStatusDisplayName(report.status) }}
            </span>
          </div>
          
          <div class="col-created-by">
            <span class="created-by">{{ report.created_by_email }}</span>
          </div>
          
          <div class="col-created">
            <div class="date">{{ formatDate(report.created_at) }}</div>
          </div>
          
          <div class="col-updated">
            <div class="date">{{ formatDate(report.updated_at) }}</div>
          </div>
          
          <div class="col-actions">
            <button 
              class="action-btn view-btn" 
              (click)="viewReport(report); $event.stopPropagation()"
              title="View Report">
              ğŸ‘ï¸
            </button>
            <button 
              *ngIf="canEdit(report)"
              class="action-btn edit-btn" 
              (click)="editReport(report, $event)"
              title="Edit Report">
              âœï¸
            </button>
            
            <button 
              *ngIf="canDelete(report)"
              class="action-btn delete-btn" 
              (click)="deleteReport(report, $event)"
              title="Delete Report">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="!loading && reports.length > 0 && totalPages > 1">
      <button 
        class="page-btn" 
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)">
        â† Previous
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of [].constructor(totalPages); let i = index"
          class="page-number" 
          [class.active]="currentPage === (i + 1)"
          (click)="goToPage(i + 1)">
          {{ i + 1 }}
        </button>
      </div>
      
      <button 
        class="page-btn" 
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)">
        Next â†’
      </button>
    </div>

    <!-- Results Summary -->
    <div class="results-summary" *ngIf="!loading">
      <p>
        Showing {{ reports.length }} of {{ totalReports }} reports
        <span *ngIf="totalPages > 1">(Page {{ currentPage }} of {{ totalPages }})</span>
      </p>
    </div>
  </div>
</div>