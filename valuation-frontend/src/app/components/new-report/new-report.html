<div class="new-report-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-button" (click)="cancelAndGoBack()">
        ‚Üê Back to Dashboard
      </button>
      <div class="page-title-section">
        <h1 class="page-title">Create New Report</h1>
        <p class="page-subtitle">Select a bank and template to get started</p>
      </div>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-steps">
    <div class="step" [class.active]="step >= 1" [class.completed]="step > 1">
      <div class="step-number">1</div>
      <div class="step-label">Select Bank</div>
    </div>
    <div class="step-connector" [class.completed]="step > 1"></div>
    <div class="step" [class.active]="step >= 2" [class.completed]="step > 2">
      <div class="step-number">2</div>
      <div class="step-label">Select Template</div>
    </div>
    <div class="step-connector" [class.completed]="step > 2"></div>
    <div class="step" [class.active]="step >= 3" [class.completed]="step > 3">
      <div class="step-number">3</div>
      <div class="step-label">Custom Template</div>
    </div>
    <div class="step-connector" [class.completed]="step > 3"></div>
    <div class="step" [class.active]="step >= 4">
      <div class="step-number">4</div>
      <div class="step-label">Create Report</div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading banks data...</p>
  </div>

  <!-- Step 1: Bank Selection -->
  <div class="step-content" *ngIf="!isLoading && step === 1">
    <div class="section-header">
      <h2 class="section-title">Select a Bank</h2>
      <p class="section-subtitle">Choose the bank for which you want to create a valuation report</p>
    </div>
    
    <div class="banks-grid">
      <div class="bank-card" 
           *ngFor="let bank of banks" 
           (click)="selectBank(bank)"
           [class.selected]="selectedBank?.bankCode === bank.bankCode"
           [style.--bank-color]="getBankThemeColor(bank.bankCode)">
        
        <!-- Bank Code Badge -->
        <div class="bank-header">
          <div class="bank-code-badge" [style.background-color]="getBankThemeColor(bank.bankCode)">
            {{ bank.bankCode }}
          </div>
        </div>

        <!-- Bank Information -->
        <div class="bank-content">
          <h3 class="bank-name">{{ bank.bankName }}</h3>
          <div class="template-count" *ngIf="bank.templates && bank.templates.length > 0">
            {{ bank.templates.length }} Templates
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 2: Template Selection -->
  <div class="step-content" *ngIf="!isLoading && step === 2">
    <div class="section-header">
      <button class="back-step-button" (click)="goBack()">
        ‚Üê Back to Bank Selection
      </button>
      <h2 class="section-title">Select Template</h2>
      <p class="section-subtitle">
        Choose a valuation template for <strong>{{ selectedBank?.bankName }}</strong>
      </p>
    </div>

    <div class="selected-bank-info">
      <div class="bank-chip">
        <span class="bank-code-badge-small" [style.background-color]="getBankThemeColor(selectedBank!.bankCode)">
          {{ selectedBank!.bankCode }}
        </span>
        <span class="bank-name">{{ selectedBank?.bankName }}</span>
      </div>
    </div>

    <div class="templates-grid" *ngIf="availableTemplates.length > 0">
      <div class="template-card" 
           *ngFor="let template of availableTemplates" 
           (click)="selectTemplate(template)"
           [class.selected]="selectedTemplate?.templateId === template.templateId"
           [class.active]="template.isActive">
        
        <!-- Template Icon -->
        <div class="template-icon-section">
          <div class="template-icon">{{ getPropertyTypeIcon(template.propertyType) }}</div>
        </div>

        <!-- Template Info -->
        <div class="template-content">
          <h3 class="template-name">{{ template.templateName }}</h3>
          <div class="template-type">{{ template.propertyType | titlecase }} Property</div>
          <div class="template-version">v{{ template.version }}</div>
        </div>
      </div>
    </div>

    <!-- No templates available -->
    <div class="no-templates" *ngIf="availableTemplates.length === 0">
      <div class="no-templates-icon">üìã</div>
      <h3 class="no-templates-title">No Templates Available</h3>
      <p class="no-templates-text">
        {{ selectedBank?.bankName }} doesn't have any specific templates. 
        You can proceed with a custom form.
      </p>
      <button class="proceed-button" (click)="proceedToForm()">
        Proceed with Custom Form
      </button>
    </div>
  </div>

  <!-- Step 3: Custom Template Selection (Optional) -->
  <div class="step-content" *ngIf="!isLoading && step === 3">
    <div class="section-header">
      <button class="back-step-button" (click)="goBack()">
        ‚Üê Back to Template Selection
      </button>
      <h2 class="section-title">Custom Template (Optional)</h2>
      <p class="section-subtitle">
        Speed up data entry by using a saved custom template, or skip to continue with an empty form
      </p>
    </div>

    <div class="selected-bank-info">
      <div class="bank-chip">
        <span class="bank-code-badge-small" [style.background-color]="getBankThemeColor(selectedBank!.bankCode)">
          {{ selectedBank!.bankCode }}
        </span>
        <span class="bank-name">{{ selectedBank?.bankName }}</span>
        <span class="separator">‚Ä¢</span>
        <span class="template-name">{{ selectedTemplate?.templateName }}</span>
      </div>
    </div>

    <!-- Loading Custom Templates -->
    <div class="loading-container-small" *ngIf="isLoadingCustomTemplates">
      <div class="loading-spinner-small"></div>
      <p class="loading-text">Loading custom templates...</p>
    </div>

    <!-- Custom Templates Available -->
    <div class="custom-templates-section" *ngIf="!isLoadingCustomTemplates && customTemplates.length > 0">
      <div class="templates-grid">
        <!-- No Template Option -->
        <div class="template-card custom-template-card" 
             (click)="skipCustomTemplate()"
             [class.selected]="!selectedCustomTemplate">
          <div class="template-icon-section">
            <div class="template-icon">üìù</div>
          </div>
          <div class="template-content">
            <h3 class="template-name">Start with Empty Form</h3>
            <div class="template-type">No pre-filled values</div>
            <div class="template-description">Fill all fields manually</div>
          </div>
        </div>

        <!-- Custom Template Options -->
        <div class="template-card custom-template-card" 
             *ngFor="let customTemplate of customTemplates" 
             (click)="selectCustomTemplate(customTemplate)"
             [class.selected]="selectedCustomTemplate?._id === customTemplate._id">
          <div class="template-icon-section">
            <div class="template-icon">‚ö°</div>
          </div>
          <div class="template-content">
            <h3 class="template-name">{{ customTemplate.templateName }}</h3>
            <div class="template-type">Pre-filled template</div>
            <div class="template-description" *ngIf="customTemplate.description">
              {{ customTemplate.description }}
            </div>
            <div class="template-meta">
              <span class="created-by">By: {{ customTemplate.createdByName }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Custom Templates -->
    <div class="no-templates" *ngIf="!isLoadingCustomTemplates && customTemplates.length === 0">
      <div class="no-templates-icon">üìù</div>
      <h3 class="no-templates-title">No Custom Templates Available</h3>
      <p class="no-templates-text">
        You don't have any saved custom templates for this bank and property type yet.
        Managers can create custom templates to speed up future data entry.
      </p>
      <button class="proceed-button" (click)="skipCustomTemplate()">
        Continue with Empty Form
      </button>
    </div>
  </div>

  <!-- Step 4: Ready to Proceed -->
  <div class="step-content" *ngIf="!isLoading && step === 4 && selectedTemplate">
    <div class="section-header">
      <button class="back-step-button" (click)="goBack()">
        ‚Üê Back to Custom Template Selection
      </button>
      <h2 class="section-title">Ready to Create Report</h2>
      <p class="section-subtitle">Review your selections and proceed to the report form</p>
    </div>

    <!-- Action Buttons at Top -->
    <div class="action-buttons-top">
      <button class="cancel-button" (click)="cancelAndGoBack()">
        Cancel
      </button>
      <button class="proceed-button primary" (click)="proceedToForm()">
        Create Report Form
      </button>
    </div>

    <div class="selection-summary">
      <div class="summary-card">
        <h3 class="summary-title">Your Selections</h3>
        
        <div class="selection-item">
          <div class="selection-label">Bank:</div>
          <div class="selection-value">
            <span class="bank-code-badge-small" [style.background-color]="getBankThemeColor(selectedBank!.bankCode)">
              {{ selectedBank!.bankCode }}
            </span>
            {{ selectedBank?.bankName }}
          </div>
        </div>

        <div class="selection-item">
          <div class="selection-label">Template:</div>
          <div class="selection-value">
            <span class="template-icon">{{ getPropertyTypeIcon(selectedTemplate.propertyType) }}</span>
            {{ selectedTemplate.templateName }}
          </div>
        </div>

        <div class="selection-item">
          <div class="selection-label">Property Type:</div>
          <div class="selection-value">{{ selectedTemplate.propertyType | titlecase }}</div>
        </div>

        <div class="selection-item" *ngIf="selectedCustomTemplate">
          <div class="selection-label">Custom Template:</div>
          <div class="selection-value">
            <span class="custom-badge">‚ö° {{ selectedCustomTemplate.templateName }}</span>
          </div>
        </div>

        <div class="selection-item" *ngIf="!selectedCustomTemplate">
          <div class="selection-label">Custom Template:</div>
          <div class="selection-value">
            <span class="no-template-badge">None (Empty form)</span>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>
